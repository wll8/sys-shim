<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style type="text/css">
    </style>
    <script type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/rpc-websockets@7.6.0/dist/index.browser-bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14"></script>
  </head>
  <body>
    <div id="box">
      <h2>sys-ui</h2>
      <button @click="msgBox">msgBox</button>
      <button @click="exit">关闭</button>
      <button @click="exitHwnd">关闭 {{ hwnd }}</button>
    </div>
  </body>
  <script>
    window.vm = new Vue({
      el: `#box`,
      data: {
        hwnd: ``,
      },
      async created() {
        const WebSocketClient = RPCWebSocket.Client
        const wsUrl = await window.ext.wsUrl
        const ws = window.ws = new WebSocketClient(wsUrl)
        window.main = await new Sys(ws)
        window.tray = await new main.Tray()
        this.hwnd = tray.hwnd
        await tray.icon(`https://www.hongqiye.com/favicon.ico`)
        await tray.tip(`tiptiptip`)
        await tray.pop(`traytray`, `msgmsgmsg`, 1)
        tray.on(`_WM_RBUTTONUP`, () => {
          console.log(`_WM_RBUTTONUP`, )
        })
        tray.on(`_WM_LBUTTONUP`, () => {
          console.log(`_WM_LBUTTONUP`, )
        })
        setTimeout(() => {
          tray.off(`_WM_RBUTTONUP`)
        }, 10000);
        window.addEventListener('blur', function() {
          document.body.append(`网页失去焦点`)
        });
        window.addEventListener('focus', function() {
          document.body.append(`网页获得焦点`)
        });
      },
      methods: {
        msgBox () {
          main.msgBox(`你好`, `title`)
        },
        exit () {
          main.exit()
        },
        exitHwnd () {
          tray.exit()
        },
      },
    });
  </script>
</html>
