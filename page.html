<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style type="text/css">
    </style>
    <title>sys-shim page</title>
    <script type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/rpc-websockets@7.6.0/dist/index.browser-bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14"></script>
  </head>
  <body>
    <div id="box">
      <h2>sys-shim</h2>
      <button @click="msgBox">msgBox</button>
      <button @click="exit">exit</button>
      <button @click="exitHwnd">exitHwnd {{ hwnd }}</button>
    </div>
  </body>
  <script>
    let ws
    let main
    let tray
    window.vm = new Vue({
      el: `#box`,
      data: {
        hwnd: ``,
      },
      async created() {
        ws = window.ws = new RPCWebSocket.Client(await window.ext.wsUrl)
        main = window.main = await new Sys(ws)
        await window.ws.call(`view.setIcon`, [window.hwnd, `https://www.baidu.com/favicon.ico`])
        tray = window.tray = await new main.Tray()
        this.hwnd = tray.hwnd
        await tray.icon(`https://www.hongqiye.com/favicon.ico`)
        await tray.tip(`tiptiptip`)
        await tray.pop(`traytray`, `msgmsgmsg`, 1)
        tray.on(`_WM_RBUTTONUP`, () => {
          console.log(`_WM_RBUTTONUP`, )
        })
        tray.on(`_WM_LBUTTONUP`, () => {
          console.log(`_WM_LBUTTONUP`, )
        })
        setTimeout(() => {
          tray.off(`_WM_RBUTTONUP`)
        }, 10000);
        window.addEventListener('blur', function() {
          document.body.append(`blur`)
        });
        window.addEventListener('focus', function() {
          document.body.append(`focus`)
        });
      },
      methods: {
        msgBox () {
          main.msgBox(`hello`, `title`)
        },
        exit () {
          main.exit()
        },
        exitHwnd () {
          tray.exit()
        },
      },
    });
  </script>
</html>
