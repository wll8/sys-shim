<div align="center">
    <a href="https://github.com/wll8/sys-shim/blob/pre/doc.md">
        æ–‡æ¡£
    </a>
  &nbsp;|&nbsp;
    <a href="https://github.com/wll8/sys-shim/releases/tag/example">
        ç¤ºä¾‹
    </a>
</div>

<br />

ç®€å•çš„ä½¿ç”¨å‰ç«¯è¯­è¨€å³å¯å¿«é€Ÿå¼€å‘æ¡Œé¢ç¨‹åºï¼Œå ç”¨å†…å­˜å’Œç¨‹åºä½“ç§¯éƒ½å¾ˆä¸è¶³ 1Mã€‚

## ä¸ºä»€ä¹ˆ

æˆ‘æƒ³å¼€å‘ä¸€ä¸ªç®€å•çš„æ¡Œé¢ç¨‹åºï¼Œåªä½¿ç”¨å‰ç«¯è¯­è¨€å¼€å‘ï¼Œæš‚åªè€ƒè™‘åœ¨ windows ä¸Šè¿è¡Œï¼Œæˆ‘å¸Œæœ›å¼€å‘ä½“éªŒåƒåœ¨æµè§ˆå™¨ä¸­ä¸€æ ·ï¼Œç„¶åç¨‹åºçš„æ ·å­åƒæ˜¯æœ¬åœ°åº”ç”¨ä¸€æ ·ï¼Œè°ƒç”¨æœ¬åœ°æ–‡ä»¶ã€ç³»ç»Ÿå‘½ä»¤ã€åå°è¿è¡Œã€æ‰˜ç›˜èœå•è¿™äº›éƒ½æ²¡æœ‰é—®é¢˜ã€‚

æˆ‘[è°ƒç ”äº†ä¸€äº›å¸¸è§çš„æ–¹æ¡ˆ](#æ–¹æ¡ˆå¯¹æ¯”)ï¼Œå‘ç°ä»–ä»¬éƒ½ä¸é€‚åˆæˆ‘ï¼Œæ‰€ä»¥æˆ‘å¼€å‘äº†é€‚åˆè‡ªå·±çš„ [xxxx](#æˆ‘çš„é€‰æ‹©) ã€‚

## å¦‚ä½•ä½¿ç”¨

ä¸‹è½½ [main](https://github.com/wll8/sys-shim/releases/download/example/main.exe) æ–‡ä»¶æ‰“å¼€ï¼Œç¼–è¾‘ç”Ÿæˆçš„ page.html æ–‡ä»¶ã€‚ æ›´å¤šåŠŸèƒ½è¯·[æŸ¥é˜…æ–‡æ¡£](https://github.com/wll8/sys-shim/blob/pre/doc.md)å’Œ[ç¤ºä¾‹](https://github.com/wll8/sys-shim/releases/tag/example)ã€‚

## æ–¹æ¡ˆå¯¹æ¯”

| åç§°        | å‰ç«¯            | åç«¯       | ä½“ç§¯ MB | å†…å­˜ MB | æ”¾å¼ƒåŸå›                              | å®˜ç½‘                                                  | å¤‡æ³¨          |
| ----------- | --------------- | ---------- | ------- | ------- | ------------------------------------ | ----------------------------------------------------- | ------------- |
| ?           | ?               | ?          | ?       | ?       | ?                                    | ?                                                     |               |
| nodegui     | chromium        | nodejs     | 100     | 100     | ä½“ç§¯å¤§                               | https://github.com/nodegui/nodegui                    |               |
| miniblink49 | Chromium        | nodejs     | ?       | ?       | ä½“ç§¯å¤§                               | https://github.com/weolar/miniblink49                 | ä»…æ”¯æŒ window |
| NW.js       | Chromium        | nodejs     | 100     | 100     | ä½“ç§¯å¤§                               | https://github.com/nwjs/nw.js                         |               |
| electron    | Chromium        | nodejs     | 100     | 100     | ä½“ç§¯å¤§                               | https://github.com/electron/electron                  |               |
| Wails       | webview         | go         | 8M      | ?       | éœ€å…¶ä»–è¯­è¨€                           | https://wails.io/                                     |               |
| Tauri       | webview         | rust       | 1       | ?       | éœ€å…¶ä»–è¯­è¨€                           | https://github.com/tauri-apps/tauri                   |               |
| Qt          | å¯é€‰            | C++        | 30      | ?       | éœ€å…¶ä»–è¯­è¨€                           | https://sciter.com/                                   |               |
| wpf         | å¯é€‰            | C#         | ?       | ?       | éœ€å…¶ä»–è¯­è¨€                           | https://learn.microsoft.com/zh-cn/dotnet/desktop/wpf/ | ä»…æ”¯æŒ window |
| Muon        | Chromium        | go         | 42      | 26      | éœ€å…¶ä»–è¯­è¨€                           | https://github.com/ImVexed/muon                       |               |
| Sciter      | Sciter          | QuickJS    | 5       | ?       | ä¸æ™®é€šæµè§ˆå™¨å’Œ nodejs å¯èƒ½æœ‰å·®å¼‚     | https://quark.sciter.com/                             |               |
| gluon       | æµè§ˆå™¨          | nodejs     | 1       | 80      | ç”Ÿæ€å°ï¼Œä¾‹å¦‚æ²¡æœ‰æ‰¾åˆ°æ‰˜ç›˜å›¾æ ‡å®ç°æ–¹å¼ | https://github.com/gluon-framework/gluon              |               |
| neutralino  | æµè§ˆå™¨          | API        | 2M      | 60      | æ²¡æœ‰ nodejs ç”Ÿæ€                     | https://github.com/neutralinojs/neutralinojs          |               |
| xxxx        | WebView2/æµè§ˆå™¨ | api/nodejs | 1       | 1       | ?                                    | https://github.com/wll8/sys-shim                      | ä»…æ”¯æŒ window |

- æ›´å¤šç›¸å…³æ¡†æ¶è¯·å‚è€ƒ: https://github.com/sudhakar3697/awesome-electron-alternatives
- ä¸‰æ–¹å¯¹æ¯”: https://github.com/Elanis/web-to-desktop-framework-comparison

## æˆ‘çš„é€‰æ‹©

å®ç°æ–¹å¼è¯·å‚è€ƒï¼š[electron å’Œ tauri éƒ½ä¸æƒ³ç”¨ï¼Œé‚£å°±è‡ªå·±å†™ä¸ªæƒ³ç”¨çš„å§](https://juejin.cn/post/7304538151480803366) ã€‚

### æ¸²æŸ“

å¯ä»¥ä»ç¨‹åºé…ç½®ä¸­æ˜¾ç¤ºå£°æ˜æ˜¯ä½¿ç”¨æµè§ˆå™¨è¿˜æ˜¯ webviewã€‚

- WebView2
  - æ”¯æŒ Win7,Win8,Win10,Win11+ã€‚
  - æ²¡æœ‰ WebView2 æ§ä»¶çš„ç³»ç»Ÿä¼šè‡ªåŠ¨å®‰è£…ã€‚
  - winin10 1803 ä»¥åŠä¹‹åçš„ç³»ç»Ÿå¾®è½¯æ—©å·²è‡ªåŠ¨æ¨é€ WebView2ã€‚ç‰ˆæœ¬å°äº 1803 çš„ Win10 å¾ˆç½•è§å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚
  - Win11 å·²è‡ªå¸¦ WebView2ã€‚
  - å¦‚æœ WebView2 å®‰è£…å¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ° WebView1ï¼ŒWebView1 æ˜¯ Win10 1803+/Win11 è‡ªå¸¦çš„æ§ä»¶ã€‚
  - å¦‚æœ WebView2 å’Œ WebView1 éƒ½ä¸å¯ç”¨ï¼Œä¼šè‡ªåŠ¨å›é€€åˆ°æµè§ˆå™¨æ–¹æ¡ˆã€‚

- æµè§ˆå™¨  
  ä½¿ç”¨ç³»ç»Ÿä¸Šå·²å®‰è£…çš„ Chromium å†…æ ¸æµè§ˆå™¨ï¼ˆä¾‹å¦‚ edgeã€2345ã€360ï¼‰æ¥æ¸²æŸ“é¡µé¢ï¼Œå¦‚æœæœªå®‰è£…ï¼Œä¼šè‡ªåŠ¨å®‰è£… Edgeã€‚

### åç«¯

- api  
  é»˜è®¤æä¾›å¸¸è§çš„æ“ä½œæ¥å£ã€‚ä¾‹å¦‚æ–‡ä»¶ã€ç½‘ç»œã€ç³»ç»Ÿã€è¿›ç¨‹ã€é¼ æ ‡ã€é”®ç›˜ã€çª—å£ç­‰ã€‚

- nodejs  
  ä½ ä¹Ÿå¯ä»¥é€‰æ‹©æ·»åŠ  nodejs æ¥è¿›è¡Œæ–‡ä»¶ã€è¿›ç¨‹ç­‰æ‰€æœ‰ç”Ÿæ€çš„æ‰€æœ‰æ“ä½œã€‚

- service  
  è‹¥ä½ çš„ç¨‹åºéœ€è¦åå°é™é»˜è¿è¡Œã€è‡ªå¯åŠ¨ç­‰ï¼Œå¯ä»¥æ·»åŠ æ­¤æ§ä»¶ã€‚

### ä½“ç§¯å†…å­˜

æ ¹æ®ä¸Šé¢çš„åˆ†æå¯è§ï¼Œå¦‚æœä½ åªéœ€è¦ä½¿ç”¨å‰ç«¯è¯­è¨€æ¥å†™ç•Œé¢ï¼Œèƒ½ä¸ç³»ç»Ÿè¿›è¡ŒåŸºæœ¬çš„äº¤äº’ï¼Œé€šå¸¸æƒ…å†µä¸‹ç¨‹åºä½“ç§¯åœ¨ 1MB å·¦å³ã€‚

### electron æ¶æ„
- ä¸»è¿›ç¨‹
  - nodejs api
  - electron api
  - åˆ›å»ºæ¸²æŸ“è¿›ç¨‹
  - è°ƒç”¨åŸç”Ÿå…ƒç´ 
  - å¼€å§‹å’Œé€€å‡º app
- æ¸²æŸ“è¿›ç¨‹
  - nodejs api
  - electron api
  - dom api
- è‡ªå®šä¹‰ dom å…ƒç´ 
- chromium å’Œ nodejs
  - å‘½ä»¤è¡Œ
  - ç¯å¢ƒå˜é‡
  - æ’ä»¶

### sys-shim ä¸­çš„å¤šçº¿ç¨‹

ç¼–å†™ä»£ç ï¼š

``` js
res = await native.win.msgbox(1234, null, 3)
```

ä»£ç é¢„å¤„ç†ï¼š

``` txt
import win
import console
console.open()

// ä»£ç  id
var runid = "xxx"

// å‡½æ•°ä»£ç 
var code = "
return win.msgbox(...)
"

// å‡½æ•°å‚æ•°
var arg = {123, null, 2}


import thread.command;
var listener = thread.command();

// åˆ›å»ºè¿”å›å€¼æ¥æ”¶å™¨
listener.res = function(runid, res ){
    console.log("runid", runid)
    console.dumpJson(res)
    // todo å‘é€åˆ°å‰ç«¯
}

// ä½¿ç”¨çº¿ç¨‹è¿è¡Œå‡½æ•°
thread.invoke(function(runid, code, ...){
  import thread.command;
  var arg = {...}
  
  var res = null
  var err = false
  try {
      res = {loadcode(code)(table.unpack(arg))}
  }
  catch (e) {
      err = tostring(e);
  }
  thread.command.res(runid, {err, table.unpack(res)});
}, runid, code, table.unpack(arg))


win.loopMessage()
```

## sys-shim é€»è¾‘

- æœ‰ page.html æ—¶åˆ™ä½¿ç”¨ webview è¿è¡Œå®ƒ
- æœ‰ sys.js åˆ™ä½¿ç”¨ nodejs è¿è¡Œå®ƒ
- å¦‚æœéƒ½æ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ª page.html

## todo

- [ ] feat: ä¼˜åŒ–ä¸æ˜¾ç¤ºæŸç›‘å¬çš„æ—¥å¿—çš„æ–¹æ³•
  - æ ¡éªŒ code ä¸ºä»… global.G.rpcServer.publish å¹¶ä¸”å‚æ•°ä¸º log æ—¶æ‰ä¸æ˜¾ç¤ºæ—¥å¿—


## chrome.webview.hostObjects

è¯¥æ–¹æ³•æ”¯æŒæŒ‚è½½ä¸‰æ–¹è¯­è¨€çš„ com å¯¹è±¡åˆ° chrome ä¸Šï¼Œæ”¯æŒè§£æ„ã€‚

- https://learn.microsoft.com/en-us/microsoft-edge/webview2/reference/win32/icorewebview2?view=webview2-1.0.705.50#addhostobjecttoscript

- ç›®å‰æœ‰ä»¥ä¸‹é—®é¢˜ï¼š
  - ä¸çŸ¥é“å¦‚ä½•ä¼ ç»“æ„ä½“ï¼Œä¾‹å¦‚ `sys.cpu.getInfo(0, {_struct: 'INT eax;BYTE ebx[4];BYTE ecx[4];BYTE edx[4]' })`
  - ä¸çŸ¥é“å¾—åˆ°å¤šä¸ªè¿”å›å€¼
  - å¦‚ä½•è·å–ä¸€ä¸ªå¯¹è±¡è¿”å›å€¼ï¼Œä¾‹å¦‚ `await native.sys.cpu.getInfoByWmi()` æƒ³å¾—åˆ°ä¸€ä¸ª json

ç¤ºä¾‹:

``` txt
winform.wb.exportHostObject("aar", global);
```


``` js
// åŒæ­¥è·å–
native = chrome.webview.hostObjects.sync.aar
native.sys.cpu.getBrand()
native.sys.getComputerName()
```

``` js
// å¼‚æ­¥è·å–
native = chrome.webview.hostObjects.aar
await native.sys.cpu.getBrand()
await native.sys.getComputerName()
```

``` js
native = chrome.webview.hostObjects.aar

// åŒæ­¥è·å–
native.sys.cpu.getBrand().sync()
await native.sys.getComputerName()
```

``` js
// è·å–å¯¹è±¡çš„å±æ€§
await native.sys.cpu.getInfoByWmi().AddressWidth
// æ‰“å°å€¼
await native.console.log(`hello`)
// å¤§ä½“ç§¯
await native.string.save(`C:/sys-shim-test/xxx.txt`, `ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦`.repeat(9e5*2))
```